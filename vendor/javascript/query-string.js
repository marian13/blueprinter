import e from"decode-uri-component";import r from"split-on-first";import{includeKeys as t}from"filter-obj";const isNullOrUndefined=e=>e===null||e===void 0;const strictUriEncode=e=>encodeURIComponent(e).replaceAll(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`));const o=Symbol("encodeFragmentIdentifier");function encoderForArrayFormat(e){switch(e.arrayFormat){case"index":return r=>(t,o)=>{const n=t.length;return o===void 0||e.skipNull&&o===null||e.skipEmptyString&&o===""?t:o===null?[...t,[encode(r,e),"[",n,"]"].join("")]:[...t,[encode(r,e),"[",encode(n,e),"]=",encode(o,e)].join("")]};case"bracket":return r=>(t,o)=>o===void 0||e.skipNull&&o===null||e.skipEmptyString&&o===""?t:o===null?[...t,[encode(r,e),"[]"].join("")]:[...t,[encode(r,e),"[]=",encode(o,e)].join("")];case"colon-list-separator":return r=>(t,o)=>o===void 0||e.skipNull&&o===null||e.skipEmptyString&&o===""?t:o===null?[...t,[encode(r,e),":list="].join("")]:[...t,[encode(r,e),":list=",encode(o,e)].join("")];case"comma":case"separator":case"bracket-separator":{const r=e.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(o,n)=>{if(n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n==="")return o;n=n===null?"":n;return o.length===0?[[encode(t,e),r,encode(n,e)].join("")]:[[o,encode(n,e)].join(e.arrayFormatSeparator)]}}default:return r=>(t,o)=>o===void 0||e.skipNull&&o===null||e.skipEmptyString&&o===""?t:o===null?[...t,encode(r,e)]:[...t,[encode(r,e),"=",encode(o,e)].join("")]}}function parserForArrayFormat(e){let r;switch(e.arrayFormat){case"index":return(e,t,o)=>{r=/\[(\d*)]$/.exec(e);e=e.replace(/\[\d*]$/,"");if(r){o[e]===void 0&&(o[e]={});o[e][r[1]]=t}else o[e]=t};case"bracket":return(e,t,o)=>{r=/(\[])$/.exec(e);e=e.replace(/\[]$/,"");r?o[e]!==void 0?o[e]=[...o[e],t]:o[e]=[t]:o[e]=t};case"colon-list-separator":return(e,t,o)=>{r=/(:list)$/.exec(e);e=e.replace(/:list$/,"");r?o[e]!==void 0?o[e]=[...o[e],t]:o[e]=[t]:o[e]=t};case"comma":case"separator":return(r,t,o)=>{const n=typeof t==="string"&&t.includes(e.arrayFormatSeparator);const a=typeof t==="string"&&!n&&decode(t,e).includes(e.arrayFormatSeparator);t=a?decode(t,e):t;const s=n||a?t.split(e.arrayFormatSeparator).map((r=>decode(r,e))):t===null?t:decode(t,e);o[r]=s};case"bracket-separator":return(r,t,o)=>{const n=/(\[])$/.test(r);r=r.replace(/\[]$/,"");if(!n){o[r]=t?decode(t,e):t;return}const a=t===null?[]:t.split(e.arrayFormatSeparator).map((r=>decode(r,e)));o[r]!==void 0?o[r]=[...o[r],...a]:o[r]=a};default:return(e,r,t)=>{t[e]!==void 0?t[e]=[...[t[e]].flat(),r]:t[e]=r}}}function validateArrayFormatSeparator(e){if(typeof e!=="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function encode(e,r){return r.encode?r.strict?strictUriEncode(e):encodeURIComponent(e):e}function decode(r,t){return t.decode?e(r):r}function keysSorter(e){return Array.isArray(e)?e.sort():typeof e==="object"?keysSorter(Object.keys(e)).sort(((e,r)=>Number(e)-Number(r))).map((r=>e[r])):e}function removeHash(e){const r=e.indexOf("#");r!==-1&&(e=e.slice(0,r));return e}function getHash(e){let r="";const t=e.indexOf("#");t!==-1&&(r=e.slice(t));return r}function parseValue(e,r){r.parseNumbers&&!Number.isNaN(Number(e))&&typeof e==="string"&&e.trim()!==""?e=Number(e):!r.parseBooleans||e===null||e.toLowerCase()!=="true"&&e.toLowerCase()!=="false"||(e=e.toLowerCase()==="true");return e}function extract(e){e=removeHash(e);const r=e.indexOf("?");return r===-1?"":e.slice(r+1)}function parse(e,t){t={decode:true,sort:true,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:false,parseBooleans:false,...t};validateArrayFormatSeparator(t.arrayFormatSeparator);const o=parserForArrayFormat(t);const n=Object.create(null);if(typeof e!=="string")return n;e=e.trim().replace(/^[?#&]/,"");if(!e)return n;for(const a of e.split("&")){if(a==="")continue;const e=t.decode?a.replaceAll("+"," "):a;let[s,c]=r(e,"=");s===void 0&&(s=e);c=c===void 0?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?c:decode(c,t);o(decode(s,t),c,n)}for(const[e,r]of Object.entries(n))if(typeof r==="object"&&r!==null)for(const[e,o]of Object.entries(r))r[e]=parseValue(o,t);else n[e]=parseValue(r,t);return t.sort===false?n:(t.sort===true?Object.keys(n).sort():Object.keys(n).sort(t.sort)).reduce(((e,r)=>{const t=n[r];e[r]=Boolean(t)&&typeof t==="object"&&!Array.isArray(t)?keysSorter(t):t;return e}),Object.create(null))}function stringify(e,r){if(!e)return"";r={encode:true,strict:true,arrayFormat:"none",arrayFormatSeparator:",",...r};validateArrayFormatSeparator(r.arrayFormatSeparator);const shouldFilter=t=>r.skipNull&&isNullOrUndefined(e[t])||r.skipEmptyString&&e[t]==="";const t=encoderForArrayFormat(r);const o={};for(const[r,t]of Object.entries(e))shouldFilter(r)||(o[r]=t);const n=Object.keys(o);r.sort!==false&&n.sort(r.sort);return n.map((o=>{const n=e[o];return n===void 0?"":n===null?encode(o,r):Array.isArray(n)?n.length===0&&r.arrayFormat==="bracket-separator"?encode(o,r)+"[]":n.reduce(t(o),[]).join("&"):encode(o,r)+"="+encode(n,r)})).filter((e=>e.length>0)).join("&")}function parseUrl(e,t){t={decode:true,...t};let[o,n]=r(e,"#");o===void 0&&(o=e);return{url:o?.split("?")?.[0]??"",query:parse(extract(e),t),...t&&t.parseFragmentIdentifier&&n?{fragmentIdentifier:decode(n,t)}:{}}}function stringifyUrl(e,r){r={encode:true,strict:true,[o]:true,...r};const t=removeHash(e.url).split("?")[0]||"";const n=extract(e.url);const a={...parse(n,{sort:false}),...e.query};let s=stringify(a,r);s&&=`?${s}`;let c=getHash(e.url);if(typeof e.fragmentIdentifier==="string"){const n=new URL(t);n.hash=e.fragmentIdentifier;c=r[o]?n.hash:`#${e.fragmentIdentifier}`}return`${t}${s}${c}`}function pick(e,r,n){n={parseFragmentIdentifier:true,[o]:false,...n};const{url:a,query:s,fragmentIdentifier:c}=parseUrl(e,n);return stringifyUrl({url:a,query:t(s,r),fragmentIdentifier:c},n)}function exclude(e,r,t){const o=Array.isArray(r)?e=>!r.includes(e):(e,t)=>!r(e,t);return pick(e,o,t)}var n=Object.freeze(Object.defineProperty({__proto__:null,exclude:exclude,extract:extract,parse:parse,parseUrl:parseUrl,pick:pick,stringify:stringify,stringifyUrl:stringifyUrl},Symbol.toStringTag,{value:"Module"}));export{n as default};

